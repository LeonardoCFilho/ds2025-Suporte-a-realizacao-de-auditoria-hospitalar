{% extends 'base.html' %}

{% block title %}Detalhe da Conta{% endblock %}

{% block content %}

<style>
    /* Card de Detalhes do Paciente */
    .detail-card {
        background-color: #ffffff;
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        height: 100%; /* Faz preencher a coluna */
    }
    .detail-card .card-header {
        background-color: #ffffff;
        border-bottom: 1px solid #f0f0f0;
        font-weight: 600;
        color: #343a40;
    }
    /* Estilo para os itens de detalhe */
    .detail-item {
        margin-bottom: 1.25rem;
    }
    .detail-item strong {
        display: block; /* Coloca o rótulo em cima */
        font-size: 0.85rem;
        color: #6c757d; /* text-muted */
        text-transform: uppercase;
        margin-bottom: 0.25rem;
    }
    .detail-item span {
        font-size: 1.05rem;
    }
    .detail-item:last-child {
        margin-bottom: 0;
    }

    /* Cards de Estatística (Resumo Financeiro) */
    .stat-card {
        background-color: #ffffff;
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    .stat-card .card-body {
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-grow: 1;
    }
    .stat-card-info h6 {
        font-size: 0.85rem;
        font-weight: 500;
        color: #6c757d;
        text-transform: uppercase;
        margin-bottom: 0.25rem;
    }
    .stat-card-info h4 {
        font-weight: 700;
        margin-bottom: 0;
    }
    .stat-card-icon {
        font-size: 2rem;
        opacity: 0.3;
    }

    /* Card da Tabela de Itens */
    .itens-card {
        background-color: #ffffff;
        border: none;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        overflow: hidden;
    }
    .itens-card .card-header {
        background-color: #ffffff;
        border-bottom: 1px solid #f0f0f0;
        font-weight: 600;
        color: #343a40;
    }
    .itens-card .card-body {
        padding: 0;
    }
    .table > thead {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
    .table > thead th {
        font-weight: 600;
        color: #495057;
    }
</style>
<h2 class="h3 mb-4" style="color: #495057;">
    <i class="bi bi-receipt-cutoff me-2"></i>
    Detalhe da Conta
</h2>

<div class
="row">
    
    <div class="col-lg-5 mb-4">
        <div class="card detail-card">
            <div class="card-header">
                <i class="bi bi-person-vcard me-2"></i>
                Informações do Paciente
            </div>
            <div class="card-body p-4">
                <h5 class="card-title fw-bold mb-3">{{ internacao.paciente.nome }}</h5>
                <div class="detail-item">
                    <strong><i class="bi bi-person-badge me-1"></i> CPF</strong>
                    <span>{{ internacao.paciente.cpf }}</span>
                </div>
                <div class="detail-item">
                    <strong><i class="bi bi-file-earmark-medical me-1"></i> Patologia</strong>
                    <span>{{ internacao.patologia.nome }} ({{ internacao.patologia.codigo_cid }})</span>
                </div>
                <div class="detail-item">
                    <strong><i class="bi bi-calendar-range me-1"></i> Período</strong>
                    <span>{{ internacao.data_entrada|date:"d/m/Y" }} até {{ internacao.data_saida|date:"d/m/Y" }}</span>
                </div>
                <div class="detail-item">
                    <strong><i class="bi bi-hourglass-split me-1"></i> Tempo de Internação</strong>
                    <span>{{ internacao.tempo_permanencia }} dias</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-7 mb-4">
        <div class="row">
            <div class="col-md-4 mb-4" style="width:100%; height: 100px;">
                <div class="stat-card">
                    <div class="card-body">
                        <div class="stat-card-info">
                            <h6>Valor Total</h6>
                            <h4>R$ {{ valor_total|floatformat:2 }}</h4>
                        </div>
                        <i class="bi bi-cash-stack stat-card-icon"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4" style="width:100%; height: 100px;">
                <div class="stat-card">
                    <div class="card-body">
                        <div class="stat-card-info">
                            <h6>Total Glosado</h6>
                            <h4 class="text-danger">R$ {{ total_glosado|floatformat:2 }}</h4>
                        </div>
                        <i class="bi bi-file-earmark-minus-fill stat-card-icon text-danger"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4" style="width:100%; height: 100px;">
                <div class="stat-card">
                    <div class="card-body">
                        <div class="stat-card-info">
                            <h6>Valor Aprovado</h6>
                            <h4 class="text-success">R$ {{ valor_total|add:"-"|add:total_glosado|floatformat:2 }}</h4>
                        </div>
                        <i class="bi bi-file-earmark-check-fill stat-card-icon text-success"></i>
                    </div>
                </div>
            </div>
        </div>
        </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card itens-card">
            <div class="card-header">
                <i class="bi bi-list-ol me-2"></i>
                Itens da Conta
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Procedimento</th>
                                <th>Código</th>
                                <th>Qtd</th>
                                <th>Valor Unit.</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in itens %}
                            <tr>
                                <td>{{ item.procedimento.nome }}</td>
                                <td>{{ item.procedimento.codigo }}</td>
                                <td>{{ item.quantidade }}</td>
                                <td>R$ {{ item.valor_unitario|floatformat:2 }}</td>
                                <td>R$ {{ item.valor_total|floatformat:2 }}</td>
                                <td>
                                    {% if item.status == 'PENDENTE' %}
                                    <span class="badge bg-warning-subtle text-warning-emphasis rounded-pill">Pendente</span>
                                    {% elif item.status == 'APROVADO' %}
                                    <span class="badge bg-success-subtle text-success-emphasis rounded-pill">Aprovado</span>
                                    {% else %}
                                    <span class="badge bg-danger-subtle text-danger-emphasis rounded-pill">Glosado</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item.status == 'PENDENTE' %}
                                    <a href="{% url 'auditoria:validar_item' item.id %}" class="btn btn-sm btn-primary">
                                        <i class="bi bi-check-lg me-1"></i>Validar
                                    </a>
                                    {% else %}
                                    <small class="text-muted">{{ item.justificativa|truncatewords:5 }}</small>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="text-center p-4">
                                    <i class="bi bi-folder-x me-2 text-muted"></i>
                                    Nenhum item lançado para esta conta.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<a href="{% url 'auditoria:analise_contas' %}" class="btn btn-secondary mt-4">
    <i class="bi bi-arrow-left-circle me-1"></i>
    Voltar
</a>
{% endblock %}